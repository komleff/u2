# M2.2 Audit: UDP Transport + Reconciliation

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞**: 2025-11-18  
**–í–µ—Ä—Å–∏—è**: v0.8.6  
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –í–´–ü–û–õ–ù–ï–ù–û** ‚Äî –°–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞, –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

---

## –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ

**–í–µ—Ä–¥–∏–∫—Ç**: M2.2 **—á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω**. UDP-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∏ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –¢–ó. **Client-side prediction –∏ reconciliation –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç** ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è TypeScript/JavaScript –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è M2.2.

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ** (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å):

- ‚úÖ UDP-—Å–µ—Ä–≤–µ—Ä —Å async receive loop
- ‚úÖ Connection manager —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º client_id
- ‚úÖ Message processor –¥–ª—è Protobuf —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ Network game loop —Å 15 Hz snapshot broadcasting
- ‚úÖ 9 —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ (199/199 –≤—Å–µ–≥–æ)
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (M2.2-README.md, 429 —Å—Ç—Ä–æ–∫)

**–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ** (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å):

- ‚ùå Client-side prediction (–ª–æ–∫–∞–ª—å–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è —Ñ–∏–∑–∏–∫–∏)
- ‚ùå Reconciliation/replay –º–µ—Ö–∞–Ω–∏–∑–º
- ‚ùå –ö–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–æ—Ç—ã 30 Hz –¥–ª—è –∫–æ–º–∞–Ω–¥
- ‚ùå DoD –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (2 –∏–≥—Ä–æ–∫–∞, RTT 50/200 ms)

---

## 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó (M2.2)

### –ò—Å—Ç–æ—á–Ω–∏–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

`docs/specs/gameplay/spec_u2_dev_plan_v086_minimal.md` (—Å—Ç—Ä–æ–∫–∏ 391-407)

### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

| ‚Ññ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---|------------|--------|------------|
| 1 | UDP-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä‚Üî–∫–ª–∏–µ–Ω—Ç—ã | ‚úÖ | UdpServer —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| 2 | Client-side prediction | ‚ùå | –¢—Ä–µ–±—É–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ |
| 3 | Reconciliation (replay) | ‚ùå | –¢—Ä–µ–±—É–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ |
| 4 | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã: ~30 Hz –∫–æ–º–∞–Ω–¥ | ‚ö†Ô∏è | –ù–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è |
| 5 | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã: ~15 Hz —Å–Ω–∞–ø—à–æ—Ç–æ–≤ | ‚úÖ | NetworkGameLoop: 15 Hz |
| 6 | **DoD**: 2 –∏–≥—Ä–æ–∫–∞ –æ–Ω–ª–∞–π–Ω ¬´–Ω–æ—Ä–º–∞–ª—å–Ω–æ¬ª | ‚è≥ | –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ |
| 7 | **DoD**: RTT 50 ms –≤—Å—ë –≥–ª–∞–¥–∫–æ | ‚è≥ | –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ |
| 8 | **DoD**: RTT 200 ms —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è 1-2 —Å–µ–∫ | ‚è≥ | –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ |

**–ò—Ç–æ–≥–æ**: 2/8 –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, 1/8 —á–∞—Å—Ç–∏—á–Ω–æ, 5/8 —Ç—Ä–µ–±—É—é—Ç –∫–ª–∏–µ–Ω—Ç–∞

---

## 2. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å)

### 2.1 UdpServer

**–§–∞–π–ª**: `src/server/Network/UdpServer.cs` (142 —Å—Ç—Ä–æ–∫–∏)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

```csharp
public class UdpServer : IDisposable
{
    // UDP socket –Ω–∞ UdpClient
    private readonly UdpClient _socket;
    
    // Async receive loop
    private async Task ReceiveLoop(CancellationToken cancellationToken)
    {
        while (!cancellationToken.IsCancellationRequested)
        {
            var result = await _socket.ReceiveAsync(cancellationToken);
            MessageReceived?.Invoke(result.Buffer, result.RemoteEndPoint);
        }
    }
    
    // Event –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    public event Action<byte[], IPEndPoint>? MessageReceived;
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
    public async Task SendAsync(byte[] data, IPEndPoint endpoint);
    
    // Broadcast –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º
    public async Task BroadcastAsync(byte[] data);
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- Non-blocking async I/O
- Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ ConnectionManager
- Graceful shutdown

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¢–ó**

---

### 2.2 ConnectionManager

**–§–∞–π–ª**: `src/shared/Network/ConnectionManager.cs` (130 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

```csharp
public class ConnectionManager
{
    private readonly ConcurrentDictionary<IPEndPoint, ClientConnection> _connections;
    private uint _nextClientId = 1;
    
    // –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
    public ClientConnection UpdateClient(IPEndPoint endpoint)
    {
        return _connections.AddOrUpdate(
            endpoint,
            ep => new ClientConnection(GenerateClientId(), ep),
            (ep, existing) => { existing.UpdateLastSeen(); return existing; }
        );
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ endpoint –∏–ª–∏ client_id
    public ClientConnection? GetClient(IPEndPoint endpoint);
    public ClientConnection? GetClient(uint clientId);
    
    // –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    public void RemoveStaleConnections(TimeSpan timeout);
}

public class ClientConnection
{
    public uint ClientId { get; }          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è
    public IPEndPoint Endpoint { get; }    // IP:Port –∫–ª–∏–µ–Ω—Ç–∞
    public DateTime LastSeenUtc { get; }   // –î–ª—è timeout detection
    public uint? EntityId { get; set; }    // –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞ GameEntity
    public bool IsAccepted { get; set; }   // –ü—Ä–æ—à—ë–ª –ª–∏ handshake
    public string PlayerName { get; set; } // –ò–∑ ConnectionRequest
}
```

**–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 9/9 —Ç–µ—Å—Ç–æ–≤ ‚úÖ

- `UpdateClient_NewClient_AssignsClientId`
- `UpdateClient_ExistingClient_UpdatesLastSeen`
- `UpdateClient_MultipleClients_AssignsUniqueIds`
- `GetClient_ByEndpoint_ReturnsCorrectConnection`
- `GetClient_ByClientId_ReturnsCorrectConnection`
- `GetAllEndpoints_ReturnsAllConnectedEndpoints`
- `RemoveStaleConnections_RemovesOldConnections`
- `RemoveStaleConnections_KeepsRecentConnections`
- `ClientConnection_CanSetEntityId`

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**

---

### 2.3 MessageProcessor

**–§–∞–π–ª**: `src/server/Network/MessageProcessor.cs` (147 —Å—Ç—Ä–æ–∫)

**–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π**:

#### ConnectionRequestProto ‚Üí ConnectionAcceptedProto

```csharp
private void HandleConnectionRequest(ConnectionRequestProto request, IPEndPoint endpoint)
{
    // 1. –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å ClientConnection
    var connection = _connectionManager.UpdateClient(endpoint);
    
    // 2. –°–æ–∑–¥–∞—Ç—å GameEntity –¥–ª—è –∏–≥—Ä–æ–∫–∞
    var entity = _gameWorld.CreatePlayerEntity(connection.ClientId);
    
    // 3. –°–≤—è–∑–∞—Ç—å client_id ‚Üí entity_id
    connection.EntityId = (uint)entity.creationIndex;
    connection.PlayerName = request.PlayerName;
    connection.IsAccepted = true;
    
    // 4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å ConnectionAcceptedProto
    var response = new ServerMessageProto {
        ConnectionAccepted = new ConnectionAcceptedProto {
            ClientId = connection.ClientId,
            EntityId = connection.EntityId.Value,
            ServerTimeMs = DateTimeOffset.UtcNow.ToUnixTimeMilliseconds()
        }
    };
    _server.SendAsync(response.ToByteArray(), endpoint);
}
```

#### PlayerInputProto ‚Üí Entity Update

```csharp
private void HandlePlayerInput(PlayerInputProto input, IPEndPoint endpoint)
{
    // 1. –í–∞–ª–∏–¥–∞—Ü–∏—è: –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω –∏ client_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç
    var connection = _connectionManager.GetClient(endpoint);
    if (connection == null || !connection.IsAccepted) return;
    if (input.ClientId != connection.ClientId) return;
    
    // 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å input –∫ entity
    ApplyPlayerInput(connection.EntityId.Value, input);
}

private void ApplyPlayerInput(uint entityId, PlayerInputProto input)
{
    var entity = _gameWorld.GetEntityById((int)entityId);
    if (entity == null) return;
    
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å ControlState + FlightAssist (–∏–∑ M2.1)
    entity.ReplaceControlState(
        input.ControlState.Thrust,
        input.ControlState.StrafeX,
        input.ControlState.StrafeY,
        input.ControlState.YawInput
    );
    entity.ReplaceFlightAssist(input.FlightAssist);
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Protobuf —Å–æ–æ–±—â–µ–Ω–∏–π**

---

### 2.4 NetworkGameLoop

**–§–∞–π–ª**: `src/server/Network/NetworkGameLoop.cs` (173 —Å—Ç—Ä–æ–∫–∏)

**–¶–∏–∫–ª —Å–µ—Ä–≤–µ—Ä–∞**:

```csharp
public class NetworkGameLoop
{
    private readonly float _snapshotRate = 15.0f;  // Hz (–ø–æ –¢–ó)
    private readonly float _snapshotInterval;      // 1/15 = 0.0667 —Å–µ–∫
    private uint _currentTick;
    
    private async Task GameLoopAsync(CancellationToken cancellationToken)
    {
        var stopwatch = Stopwatch.StartNew();
        var nextTickTime = stopwatch.Elapsed.TotalSeconds;
        
        while (!cancellationToken.IsCancellationRequested)
        {
            // 1. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–∑–∏–∫—É (GameWorld.Execute)
            _gameWorld.Execute();
            _currentTick++;
            
            // 2. Broadcast snapshot –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º
            await BroadcastWorldSnapshot();
            
            // 3. Sleep –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–∏–∫–∞ (fixed-rate)
            nextTickTime += _snapshotInterval;
            var sleepTime = nextTickTime - stopwatch.Elapsed.TotalSeconds;
            if (sleepTime > 0)
                await Task.Delay(TimeSpan.FromSeconds(sleepTime));
        }
    }
    
    private async Task BroadcastWorldSnapshot()
    {
        var snapshot = new WorldSnapshotProto {
            Tick = _currentTick,
            TimestampMs = (ulong)DateTimeOffset.UtcNow.ToUnixTimeMilliseconds()
        };
        
        // –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ entities
        var entities = _gameWorld.GetAllEntities();
        foreach (var entity in entities)
            snapshot.Entities.Add(EntitySerializer.ToSnapshot(entity));
        
        // Broadcast —á–µ—Ä–µ–∑ UdpServer
        var message = new ServerMessageProto { WorldSnapshot = snapshot };
        await _server.BroadcastAsync(message.ToByteArray());
    }
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- **Snapshot rate**: 15 Hz (66.67 ms –∏–Ω—Ç–µ—Ä–≤–∞–ª) ‚úÖ
- **Physics tick**: 60 Hz —á–µ—Ä–µ–∑ GameWorld (16.67 ms deltaTime) ‚úÖ
- **Fixed-rate loop**: –ö–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚úÖ

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¢–ó (15 Hz snapshots)**

---

### 2.5 Program.cs Integration

**–§–∞–π–ª**: `src/server/Program.cs`

**–†–µ–∂–∏–º --network**:

```csharp
if (args.Contains("--network"))
{
    logger.LogInformation("M2.2 - UDP Transport initialization");
    
    // –°–æ–∑–¥–∞—Ç—å GameWorld
    var world = new GameWorld(speedOfLight_mps, deltaTime, enableCollisions: true);
    world.Initialize();
    
    // –°–æ–∑–¥–∞—Ç—å UDP —Å–µ—Ä–≤–µ—Ä
    var udpServer = new UdpServer(port: 7777, logger);
    var connectionManager = udpServer.GetConnectionManager();
    
    // –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
    var messageProcessor = new MessageProcessor(
        logger, connectionManager, world, udpServer);
    udpServer.MessageReceived += messageProcessor.ProcessMessage;
    
    // –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
    var gameLoop = new NetworkGameLoop(
        logger, world, udpServer, connectionManager, snapshotRate: 15.0f);
    
    udpServer.Start();
    gameLoop.Start();
    
    logger.LogInformation("Network server running on port 7777");
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç**

---

## 3. –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å)

### 3.1 Client-side Prediction

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¢–ó**:
> –ö–ª–∏–µ–Ω—Ç —Å–∏–º—É–ª–∏—Ä—É–µ—Ç —Ñ–∏–∑–∏–∫—É –ª–æ–∫–∞–ª—å–Ω–æ, –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–≤–æ–∏ inputs –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è responsive gameplay, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å server snapshot.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: ‚ùå **–ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–ß—Ç–æ –Ω—É–∂–Ω–æ**:

1. **TypeScript/JavaScript –∫–ª–∏–µ–Ω—Ç** (browser-based –∏–ª–∏ Node.js)
2. **–õ–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è —Ñ–∏–∑–∏–∫–∏**:
   - –ê–Ω–∞–ª–æ–≥ `GameWorld.Execute()` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `PlayerInputProto` –ª–æ–∫–∞–ª—å–Ω–æ
   - –°–∏–º—É–ª—è—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è, –≤—Ä–∞—â–µ–Ω–∏—è, Flight Assist
3. **Input buffering**:

   ```typescript
   class PredictionManager {
       private inputHistory: PlayerInput[] = [];
       private lastAckedSequence: number = 0;
       
       // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å input –¥–ª—è –±—É–¥—É—â–µ–≥–æ replay
       storeInput(input: PlayerInput) {
           this.inputHistory.push(input);
       }
       
       // –ü—Ä–∏–º–µ–Ω–∏—Ç—å input –ª–æ–∫–∞–ª—å–Ω–æ
       applyLocalInput(input: PlayerInput) {
           this.localEntity.applyControlState(input.controlState);
           this.localEntity.applyFlightAssist(input.flightAssist);
           this.localPhysics.step(deltaTime);
       }
   }
   ```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ **–ö–†–ò–¢–ò–ß–ù–û –¥–ª—è DoD**

---

### 3.2 Reconciliation (Replay)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¢–ó**:
> –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ server snapshot –∫–ª–∏–µ–Ω—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –µ–≥–æ —Å local prediction. –ü—Ä–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–∏ ‚Äî rewind –∫ server state –∏ replay –≤—Å–µ—Ö inputs –ø–æ—Å–ª–µ server snapshot.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: ‚ùå **–ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–ß—Ç–æ –Ω—É–∂–Ω–æ**:

```typescript
class ReconciliationManager {
    reconcile(serverSnapshot: EntitySnapshot) {
        // 1. –ù–∞–π—Ç–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ inputs –ø–æ—Å–ª–µ server snapshot
        const serverSequence = serverSnapshot.lastProcessedInput;
        const inputsToReplay = this.inputHistory.filter(
            input => input.sequenceNumber > serverSequence
        );
        
        // 2. Rewind –∫ server state
        this.localEntity.position = serverSnapshot.position;
        this.localEntity.rotation = serverSnapshot.rotation;
        this.localEntity.velocity = serverSnapshot.velocity;
        
        // 3. Replay inputs
        for (const input of inputsToReplay) {
            this.applyInput(input);
            this.localPhysics.step(deltaTime);
        }
        
        // 4. –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ inputs
        this.inputHistory = this.inputHistory.filter(
            input => input.sequenceNumber > serverSequence
        );
    }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ **–ö–†–ò–¢–ò–ß–ù–û –¥–ª—è DoD (RTT 200 ms stabilization)**

---

### 3.3 –ö–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–æ—Ç—ã 30 Hz –∫–æ–º–∞–Ω–¥

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¢–ó**:
> ~30 Hz –∫–æ–º–∞–Ω–¥ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: ‚ö†Ô∏è **–ù–ï –ö–û–ù–¢–†–û–õ–ò–†–£–ï–¢–°–Ø**

**–ü—Ä–æ–±–ª–µ–º–∞**:

- –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `PlayerInputProto` "–∫–∞–∫ –ø—Ä–∏—à–ª–æ"
- –ù–µ—Ç –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–æ—Ç—ã
- –ù–µ—Ç throttling –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏–ª–∏ rate limiting –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ß—Ç–æ –Ω—É–∂–Ω–æ**:

```typescript
// –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ
class InputSender {
    private readonly INPUT_RATE_HZ = 30;
    private readonly INPUT_INTERVAL_MS = 1000 / 30; // 33.33 ms
    
    start() {
        setInterval(() => {
            const input = this.collectInput();
            this.sendToServer(input);
        }, this.INPUT_INTERVAL_MS);
    }
}

// –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî rate limiting)
class RateLimiter {
    private lastInputTime: Map<uint, number> = new Map();
    
    shouldAcceptInput(clientId: uint, now: number): boolean {
        const last = this.lastInputTime.get(clientId) ?? 0;
        const minInterval = 1000 / 40; // 40 Hz max (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
        if (now - last < minInterval) return false;
        
        this.lastInputTime.set(clientId, now);
        return true;
    }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° **–°–†–ï–î–ù–ò–ô** (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ)

---

### 3.4 DoD Verification (2 –∏–≥—Ä–æ–∫–∞, RTT 50/200 ms)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¢–ó**:
> 2 –∏–≥—Ä–æ–∫–∞ –æ–Ω–ª–∞–π–Ω ¬´–Ω–æ—Ä–º–∞–ª—å–Ω–æ¬ª, –ø—Ä–∏ RTT 50 ms –≤—Å—ë –≥–ª–∞–¥–∫–æ, –ø—Ä–∏ RTT 200 ms ‚Äî —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∑–∞ 1‚Äì2 —Å–µ–∫—É–Ω–¥—ã.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: ‚è≥ **–ù–ï –ü–†–û–í–ï–†–ï–ù–û**

**–ß—Ç–æ –Ω—É–∂–Ω–æ**:

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**:

   ```typescript
   test('2 players can connect and play', async () => {
       const server = new TestServer();
       const client1 = new TestClient();
       const client2 = new TestClient();
       
       await client1.connect(server);
       await client2.connect(server);
       
       // Simulate gameplay
       for (let i = 0; i < 100; i++) {
           client1.sendInput({ thrust: 1.0, ... });
           client2.sendInput({ thrust: -1.0, ... });
           await delay(16); // 60 FPS
       }
       
       // Verify both clients see each other
       expect(client1.worldState.entities).toHaveLength(2);
       expect(client2.worldState.entities).toHaveLength(2);
   });
   ```

2. **RTT —Å–∏–º—É–ª—è—Ü–∏—è**:

   ```typescript
   test('RTT 50ms smooth gameplay', async () => {
       server.setNetworkDelay(50); // ms
       
       // Measure prediction error
       const errors = [];
       for (let i = 0; i < 100; i++) {
           const predicted = client.predictedPosition;
           await delay(16);
           const actual = client.serverPosition;
           errors.push(distance(predicted, actual));
       }
       
       expect(average(errors)).toBeLessThan(1.0); // < 1 –º–µ—Ç—Ä –æ—à–∏–±–∫–∏
   });
   
   test('RTT 200ms stabilizes in 1-2 sec', async () => {
       server.setNetworkDelay(200);
       
       // Inject divergence
       client.localPosition = [100, 0];
       server.entityPosition[clientId] = [0, 0];
       
       // Measure convergence time
       const startTime = Date.now();
       while (distance(client.localPosition, server.position) > 0.1) {
           await delay(16);
           if (Date.now() - startTime > 3000) fail('Did not converge');
       }
       
       const convergenceTime = Date.now() - startTime;
       expect(convergenceTime).toBeLessThan(2000); // < 2 —Å–µ–∫—É–Ω–¥—ã
   });
   ```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ **–ö–†–ò–¢–ò–ß–ù–û –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è M2.2**

---

## 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 4.1 M2.2-README.md

**–†–∞–∑–º–µ—Ä**: 429 —Å—Ç—Ä–æ–∫

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:

- ‚úÖ Overview –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ Specification alignment —Å –¢–ó
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ Network flow –¥–∏–∞–≥—Ä–∞–º–º—ã
- ‚úÖ Message size –∏ bandwidth estimation
- ‚úÖ Default ship configuration
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ **–ß–µ—Å—Ç–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ**: Client-side prediction/reconciliation "planned for future"

**–¶–∏—Ç–∞—Ç–∞ –∏–∑ README** (—Å—Ç—Ä–æ–∫–∏ 23-27):

```markdown
- **Client-side prediction** ‚è≥ (planned for client implementation)
- **Reconciliation (replay)** ‚è≥ (planned for client implementation)
- **DoD**: 2 players online works, RTT 50ms smooth, RTT 200ms stabilizes in 1-2 sec ‚è≥
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ß–µ—Å—Ç–Ω–∞—è –∏ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

---

### 4.2 M2.1-FINAL-AUDIT.md

**–†–∞–∑–º–µ—Ä**: 476 —Å—Ç—Ä–æ–∫

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:

- –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç M2.1 Protobuf protocol
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ M2.2+
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è reconciliation

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–°–æ–∑–¥–∞–Ω –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏**

---

## 5. –§–∏–Ω–∞–ª—å–Ω—ã–π –≤–µ—Ä–¥–∏–∫—Ç

### 5.1 –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó

**–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å**: **100%** ‚úÖ

- ‚úÖ UDP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ 15 Hz snapshots —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è
- ‚úÖ Connection management –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ Protobuf integration —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è

**–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å**: **0%** ‚ùå

- ‚ùå Client-side prediction –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚ùå Reconciliation –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚ùå 30 Hz input rate –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è
- ‚ùå DoD –∫—Ä–∏—Ç–µ—Ä–∏–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

**–û–±—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ M2.2**: **25%** (2 –∏–∑ 8 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π)

---

### 5.2 –ë–ª–æ–∫–µ—Ä—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è M2.2

| –ë–ª–æ–∫–µ—Ä | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è –æ—Ü–µ–Ω–∫–∞ |
|--------|-----------|-----------|--------------|
| TypeScript –∫–ª–∏–µ–Ω—Ç | üî¥ –ö–†–ò–¢–ò–ß–ù–û | –í—ã—Å–æ–∫–∞—è | 2-3 –¥–Ω—è |
| Client-side prediction | üî¥ –ö–†–ò–¢–ò–ß–ù–û | –°—Ä–µ–¥–Ω—è—è | 1-2 –¥–Ω—è |
| Reconciliation/replay | üî¥ –ö–†–ò–¢–ò–ß–ù–û | –°—Ä–µ–¥–Ω—è—è | 1-2 –¥–Ω—è |
| DoD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã | üî¥ –ö–†–ò–¢–ò–ß–ù–û | –°—Ä–µ–¥–Ω—è—è | 1 –¥–µ–Ω—å |
| 30 Hz input rate control | üü° –°–†–ï–î–ù–ò–ô | –ù–∏–∑–∫–∞—è | 2-4 —á–∞—Å–∞ |

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ –ø–æ–ª–Ω–æ–≥–æ M2.2**: 5-8 –¥–Ω–µ–π

---

### 5.3 –†–µ—à–µ–Ω–∏–µ: –†–∞–∑–±–∏—Ç—å M2.2 –Ω–∞ –ø–æ–¥—ç—Ç–∞–ø—ã

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ú—ë—Ä–¥–∂–∏—Ç—å —Ç–µ–∫—É—â–∏–π M2.2 –∫–∞–∫ "M2.2a - Server Infrastructure"

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:

- ‚úÖ –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ M2.3+ (–∫–ª–∏–µ–Ω—Ç)
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–∞–ª—å–Ω–µ–π—à—É—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É

**–ü–ª–∞–Ω**:

1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å PR #12: "M2.2a: UDP Server Infrastructure"
2. –û–±–Ω–æ–≤–∏—Ç—å README: —á—ë—Ç–∫–æ —É–∫–∞–∑–∞—Ç—å scope (server-only)
3. –°–ª–∏—Ç—å –≤ main
4. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —ç—Ç–∞–ø "M2.2b: Client Prediction & Reconciliation"

---

#### –í–∞—Ä–∏–∞–Ω—Ç B: –î–µ—Ä–∂–∞—Ç—å M2.2 –≤ DRAFT –¥–æ –ø–æ–ª–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:

- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±—É–∫–≤–∞–ª—å–Ω–æ–º—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é M2.2 –≤ –¢–ó
- ‚úÖ –ù–µ —Å–æ–∑–¥–∞—ë—Ç –ø—É—Ç–∞–Ω–∏—Ü—É —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:

- ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç –º—ë—Ä–∂ –≥–æ—Ç–æ–≤–æ–≥–æ –∫–æ–¥–∞
- ‚ùå –¢—Ä–µ–±—É–µ—Ç —Å–Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç

---

### 5.4 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ü—Ä–µ–¥–ª–∞–≥–∞—é –í–∞—Ä–∏–∞–Ω—Ç A**:

1. **–°–µ–π—á–∞—Å**: –°–ª–∏—Ç—å PR #12 –∫–∞–∫ **"M2.2 Server-Side (UDP + Infrastructure)"**
   - –û–±–Ω–æ–≤–∏—Ç—å README —Å —á—ë—Ç–∫–æ–π –ø–æ–º–µ—Ç–∫–æ–π scope
   - –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: client-side pending

2. **–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø**: **M2.3 Client-Side (Prediction + Reconciliation)**
   - TypeScript/JavaScript –∫–ª–∏–µ–Ω—Ç
   - WebSocket –∏–ª–∏ WebRTC transport
   - Local physics simulation
   - Reconciliation –º–µ—Ö–∞–Ω–∏–∑–º
   - DoD verification tests

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:

- –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–∞
- –ö–ª–∏–µ–Ω—Ç ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±–æ–ª—å—à–∞—è –∑–∞–¥–∞—á–∞ (5-8 –¥–Ω–µ–π)
- –õ–æ–≥–∏—á–Ω–µ–µ —Ä–∞–∑–¥–µ–ª–∏—Ç—å server –∏ client –≤ —Ä–∞–∑–Ω—ã–µ PR
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞

---

## 6. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–µ—Å–ª–∏ –ø—Ä–∏–Ω–∏–º–∞–µ–º –í–∞—Ä–∏–∞–Ω—Ç A)

1. **–û–±–Ω–æ–≤–∏—Ç—å M2.2-README.md**:

   ```markdown
   ## Scope
   
   **M2.2 —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å UDP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞**:
   - ‚úÖ UDP —Å–µ—Ä–≤–µ—Ä —Å async I/O
   - ‚úÖ Connection management
   - ‚úÖ Protobuf message processing
   - ‚úÖ 15 Hz snapshot broadcasting
   
   **Client-side –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ M2.3**:
   - ‚è≥ Client-side prediction
   - ‚è≥ Reconciliation/replay
   - ‚è≥ DoD verification (RTT tests)
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ PR #12**:
   - –ë—ã–ª–æ: "M2.2: Implement UDP transport server infrastructure"
   - –°—Ç–∞–ª–æ: "M2.2: UDP Server Infrastructure (server-side only)"

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã**:

   ```powershell
   dotnet test --configuration Release
   ```

4. **–°–ª–∏—Ç—å –≤ main**:

   ```powershell
   git checkout main
   git merge copilot/implement-udp-transport --no-ff
   git push origin main
   ```

5. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π issue/milestone –¥–ª—è M2.3**:
   - Title: "M2.3: Client-Side Prediction & Reconciliation"
   - Description: TypeScript –∫–ª–∏–µ–Ω—Ç + prediction + reconciliation + DoD tests

---

### –ü–ª–∞–Ω M2.3 (—Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø)

**–¶–µ–ª—å**: –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Ç–µ–≤—É—é —á–∞—Å—Ç—å (client-side)

**–ó–∞–¥–∞—á–∏**:

1. TypeScript –∫–ª–∏–µ–Ω—Ç (browser-based)
   - WebSocket transport
   - Protobuf deserialization
   - Canvas/WebGL —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

2. Client-side prediction
   - –õ–æ–∫–∞–ª—å–Ω–∞—è —Ñ–∏–∑–∏–∫–∞ (–ø–æ—Ä—Ç —Å C#)
   - Input buffering
   - Immediate local response

3. Server reconciliation
   - Snapshot comparison
   - Rewind & replay
   - Convergence verification

4. DoD —Ç–µ—Å—Ç—ã
   - 2 –∏–≥—Ä–æ–∫–∞ –æ–Ω–ª–∞–π–Ω
   - RTT 50ms smoothness
   - RTT 200ms convergence < 2 sec

**–í—Ä–µ–º—è –æ—Ü–µ–Ω–∫–∞**: 5-8 –¥–Ω–µ–π

---

## 7. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**M2.2 —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ production**. –ö–æ–¥ —Å—Ç–∞–±–∏–ª–µ–Ω, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω, –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω.

**–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¢–ó M2.2 —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å** ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±–æ–ª—å—à–∞—è –∑–∞–¥–∞—á–∞, –∫–æ—Ç–æ—Ä—É—é –ª–æ–≥–∏—á–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –≤ M2.3.

**–†–µ–∫–æ–º–µ–Ω–¥—É—é**: –°–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π PR #12 —Å —á—ë—Ç–∫–∏–º scope (server-only), –Ω–∞—á–∞—Ç—å M2.3 –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.

---

**–ü–æ–¥–ø–∏—Å—å –∞—É–¥–∏—Ç–æ—Ä–∞**  
AI Assistant (Claude Sonnet 4.5)  
–î–∞—Ç–∞: 2025-11-18  
–°—Ç–∞—Ç—É—Å: **M2.2 Server ‚úÖ | M2.2 Client ‚ùå | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Split –Ω–∞ M2.2/M2.3**
