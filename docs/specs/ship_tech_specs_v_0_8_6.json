// U2 — Ship Tech Specs v0.8.6 (runtime config)
// Формат ТТХ кораблей для версии 0.8.6.
// Используется клиентом и сервером для 2D космосима с режимами Flight Assist ON/OFF по модели Elite Dangerous.
// Все скорости и ускорения заданы в СИ (метры/секунда, м/с; метры/секунда², м/с²).

1. Назначение формата
- Описывает неизменяемые свойства корпуса: метаданные, класс/архетип, габариты, массу, прочность корпуса, базовую сигнатуру, кинематические параметры и ограничения по перегрузкам экипажа.
- Логика управления, схема кнопок и общий алгоритм Flight Assist задаются глобально (в конфиге системы управления), а не per-ship.
- Тепло, энергетика, щиты, броня, модули и технологии в v0.8.6 НЕ входят в ТТХ корабля.

2. Общая структура JSON-конфига корабля

{
  "meta": { ... },
  "classification": { ... },
  "geometry": { ... },
  "hull": { ... },
  "physics": { ... },
  "flightAssistLimits": { ... },
  "media": { ... }
}

Все поля обязательны, если явно не указано обратное.

3. meta — идентификация корабля

meta: {
  "id": string,           // стабильный ID корпуса, snake_case. Пример: "origin_m50"
  "name": string,         // отображаемое имя корабля
  "manufacturer": string, // производитель/происхождение лора. Для импортированных SC-кораблей: "Star Citizen"
  "version": string       // версия конфига ТТХ, для этой схемы: "0.8.6"
}

4. classification — класс и размер

classification: {
  "size": "snub" | "light" | "medium" | "heavy" | "capital",
  "type": string,          // архетип/класс: interceptor, fighter, bomber, courier, trader, corvette, frigate, destroyer, carrier и т.п.
  "stealth"?: "standard" | "stealth", // профиль заметности корпуса
  "variant"?: string       // человекочитаемый вариант корпуса, например "Sport Interceptor"
}

Примечания:
- В 0.8.6 значение "small" переименовано в "light".
- Остальные размеры (snub, medium, heavy, capital) без изменений.

5. geometry — габариты корпуса

geometry: {
  "length_m": number,      // длина корпуса, м
  "width_m": number,       // ширина, м
  "height_m": number,      // высота, м
  "hull_radius_m"?: number // радиус аппроксимирующей сферы, для коллизий/LOD (опционально)
}

6. hull — параметры корпуса (масса, прочность, сигнатура)

hull: {
  "dryMass_t": number,    // сухая масса корпуса (масса корабля без топлива и груза), тонн
  "hull_HP": number,  // базовая прочность корпуса (HP) без учёта модулей, щитов и временных эффектов
  "signature_km": number // базовый радиус обнаружения корпуса в километрах для стандартного (не stealth) варианта
}

Замечания:
- "signature_km" — это уже готовое значение, которое использует сервер. Сложные формулы расчёта сигнатуры (по массе, габаритам, теплу) находятся во внешних тулзах/редакторе и в рантайме не считаются.
- Для stealth-вариантов применяется простой множитель к signature_km (см. План/Архитектуру 0.8.6).

7. physics — кинематика корпуса (сырой потенциал, FA:OFF)

physics: {
  "linearAcceleration_mps2": {
    "forward": number,  // разгон вперёд при 100% маршевой тяге без буста (м/с²), копируется из accel_fwd_mps2 SC-конфигов
    "reverse"?: number  // торможение/разгон назад. Если не задано, редактор подставляет ~0.7 * forward
  },

  "strafeAcceleration_mps2": {
    "lateral": number,   // боковое ускорение для стрейфа в 2D (м/с²), для SC-конфигов берётся из strafe_mps2.x
    "vertical"?: number  // вертикальное ускорение (м/с²); в 2D можно не задавать, тогда = lateral
  },

  "angularAcceleration_dps2": {    // управляет "резвостью" поворота корпуса
    "pitch": number,               // град/с²
    "yaw": number,
    "roll": number
  }
}

Интерпретация:
- Эти параметры описывают физический потенциал корпуса при Flight Assist OFF: максимальные линейные и угловые ускорения.
- В режиме Flight Assist OFF симуляция использует именно эти ускорения, **не накладывая ограничений на линейные и угловые скорости** (кроме глобальных предохранителей движка).

8. flightAssistLimits — ограничения для экипажа и стабилизированного полёта (FA:ON)

flightAssistLimits: {
  "crewGLimit": {
    "linear_g": number // максимально допустимая для экипажа линейная перегрузка в g (1 g = 9.81 м/с²)
  },
  "linearSpeedMax_mps": {        // лимиты скорости по осям в стабилизированном режиме (м/с)
    "forward": number,           // максимально допустимая скорость вперёд
    "reverse": number,           // максимально допустимая скорость назад
    "lateral": number,           // максимально допустимая скорость вбок
    "vertical": number           // максимально допустимая скорость вверх/вниз (для 2D может совпадать с lateral)
  },
  "angularSpeedMax_dps": {       // лимиты угловой скорости в FA:ON (град/с)
    "pitch": number,
    "yaw": number,
    "roll": number
  }
}

Семантика режимов:

- **Flight Assist OFF (свободный полёт):**
  - Оси управления независимы.
  - Команды игрока напрямую масштабируются в тягу/момент в пределах максимальных ускорений из блока `physics`.
  - Линейные и угловые скорости **не ограничиваются** значениями из `flightAssistLimits.linearSpeedMax_mps` и `angularSpeedMax_dps` — корабль может продолжать разгоняться, пока это допускает физика и общие защитные системы.
  - Перегрузки экипажа рассчитываются из фактических ускорений; обработка эффектов (blackout, урон) реализуется в глобальной подсистеме и использует `crewGLimit.linear_g` как порог.

- **Flight Assist ON (стабилизированный полёт):**
  - Автопилот стабилизирует корабль, гасит скорость до выбранного целевого вектора и удерживает его.
  - Компоненты линейной скорости по осям ограничиваются полем `flightAssistLimits.linearSpeedMax_mps`:
    - вперёд — `forward`, назад — `reverse`, вбок — `lateral`, вверх/вниз — `vertical`.
  - Угловые скорости по pitch/yaw/roll ограничиваются `flightAssistLimits.angularSpeedMax_dps.*`.
  - Автопилот старается не превышать `crewGLimit.linear_g` при разгоне/торможении; при необходимости он не отдаёт полную тягу, даже если `physics.linearAcceleration_mps2` позволяет.

Таким образом:
- Для FA:OFF ядро использует **максимальные ускорения из physics**, без лимита скоростей со стороны ТТХ.
- Для FA:ON ядро использует те же ускорения physics, но автопилот режет скорость и g до значений, безопасных для экипажа и геймплея, отдельно по каждой оси.

9. media — визуальные ресурсы

media: {
  "sprite": {
    "name": string,      // имя файла спрайта
    "path"?: string,     // относительный путь до файла в проекте
    "width"?: number,    // ширина спрайта в пикселях (для редактора)
    "height"?: number,   // высота спрайта в пикселях (для редактора)
    "dataUrl"?: string   // опциональный встроенный data:image/png;base64,... для предпросмотра в редакторе
  }
}

10. Nominals v0.8.6 — эталонные классы (для редактора)

Файл nominals (TS/JS) используется редактором для автозаполнения ТТХ новых кораблей по классу.

Пример заголовка файла:

export const NOMINALS_VERSION = "0.8.6";
export const NOMINALS_MODE = "assisted"; // ED-like Flight Assist

// Рекомендованная формула для предварительного расчёта сигнатуры (в тулзанах, НЕ на сервере):
//   M_t = hull.dryMass_t (тонны)
//   signature_km = R0 * (M_t / M0)^a
//   M0 = 10 т, R0 = 9.5 км, a = 0.24
// Тогда:
//   - стелс-снаб ~5 т: signature_km ≈ 8 км → при стелсе обнаружение ≈ 4 км
//   - capital (~10 000 т): signature_km ≈ 50 км
// Учёт стелса при расчёте радиуса обнаружения на сервере:
//   detectionRadius_km = signature_km * k_stealth
//   k_stealth = 1.0 для standard, k_stealth = 0.5 для stealth.
// На сервер уходит уже готовое значение hull.signature_km, формула здесь не нужна.

export const NOMINALS = {
  "light interceptor": {
    classification: { size: "light", type: "interceptor" },
    hull: { dryMass_t: 10, hull_HP: 1000, signature_km: 9.5 },
    geometry: { length_m: 11.5, width_m: 11.0, height_m: 3.5 },
    physics: {
      linearAcceleration_mps2: { forward: 90, reverse: 70 },
      strafeAcceleration_mps2: { lateral: 85 },
      angularAcceleration_dps2: { pitch: 240, yaw: 200, roll: 325 }
    },
    flightAssistLimits: {
      crewGLimit: { linear_g: 11.0 },               // спортивный/гоночный, самый высокий допуск по g
      linearSpeedMax_mps: {
        forward: 260,
        reverse: 180,
        lateral: 220,
        vertical: 220
      },
      angularSpeedMax_dps: { pitch: 95, yaw: 80, roll: 130 }
    }
  },

  "light fighter": {
    classification: { size: "light", type: "fighter" },
    hull: { dryMass_t: 25, hull_HP: 1500, signature_km: 11.8 },
    geometry: { length_m: 18, width_m: 16, height_m: 5 },
    physics: {
      linearAcceleration_mps2: { forward: 70, reverse: 55 },
      strafeAcceleration_mps2: { lateral: 60 },
      angularAcceleration_dps2: { pitch: 190, yaw: 165, roll: 260 }
    },
    flightAssistLimits: {
      crewGLimit: { linear_g: 9.0 },                // боевые истребители, ниже чем спорт, выше гражданских
      linearSpeedMax_mps: {
        forward: 230,
        reverse: 150,
        lateral: 190,
        vertical: 190
      },
      angularSpeedMax_dps: { pitch: 80, yaw: 70, roll: 110 }
    }
  },

  "medium courier": {
    classification: { size: "medium", type: "courier" },
    hull: { dryMass_t: 70, hull_HP: 3000, signature_km: 15.2 },
    geometry: { length_m: 24, width_m: 16, height_m: 6 },
    physics: {
      linearAcceleration_mps2: { forward: 50, reverse: 40 },
      strafeAcceleration_mps2: { lateral: 35 },
      angularAcceleration_dps2: { pitch: 130, yaw: 110, roll: 180 }
    },
    flightAssistLimits: {
      crewGLimit: { linear_g: 6.0 },                // быстрый гражданский/почтовый корабль
      linearSpeedMax_mps: {
        forward: 210,
        reverse: 140,
        lateral: 160,
        vertical: 160
      },
      angularSpeedMax_dps: { pitch: 60, yaw: 50, roll: 80 }
    }
  },

  "heavy freighter": {
    classification: { size: "heavy", type: "freighter" },
    hull: { dryMass_t: 500, hull_HP: 8000, signature_km: 24.3 },
    geometry: { length_m: 80, width_m: 40, height_m: 20 },
    physics: {
      linearAcceleration_mps2: { forward: 20, reverse: 15 },
      strafeAcceleration_mps2: { lateral: 10 },
      angularAcceleration_dps2: { pitch: 55, yaw: 45, roll: 70 }
    },
    flightAssistLimits: {
      crewGLimit: { linear_g: 4.0 },                // грузовые суда, низкий комфортный g-лимит
      linearSpeedMax_mps: {
        forward: 150,
        reverse: 90,
        lateral: 110,
        vertical: 110
      },
      angularSpeedMax_dps: { pitch: 25, yaw: 20, roll: 30 }
    }
  },

  "capital frigate": {
    classification: { size: "capital", type: "frigate" },
    hull: { dryMass_t: 10000, hull_HP: 20000, signature_km: 49.9 },
    geometry: { length_m: 250, width_m: 80, height_m: 50 },
    physics: {
      linearAcceleration_mps2: { forward: 10, reverse: 8 },
      strafeAcceleration_mps2: { lateral: 5 },
      angularAcceleration_dps2: { pitch: 30, yaw: 25, roll: 40 }
    },
    flightAssistLimits: {
      crewGLimit: { linear_g: 3.0 },                // пассажирские/капитал, самые щадящие перегрузки
      linearSpeedMax_mps: {
        forward: 120,
        reverse: 70,
        lateral: 80,
        vertical: 80
      },
      angularSpeedMax_dps: { pitch: 15, yaw: 12, roll: 20 }
    }
  }
};

Градация g-лимитов по архетипам:
- Спортивные и гоночные корабли: 10–12 g.
- Боевые истребители/перехватчики: 8–10 g.
- Быстрые гражданские (courier, executive): 6–8 g.
- Грузовые и вспомогательные суда: 4–6 g.
- Пассажирские лайнеры и capital-корабли: 3–4 g.

11. Пример конфига Origin M50 Interceptor (v0.8.6)

{
  "meta": {
    "id": "origin_m50",
    "name": "Origin M50 Interceptor",
    "manufacturer": "Star Citizen",
    "version": "0.8.6"
  },
  "classification": {
    "size": "snub",
    "type": "interceptor",
    "stealth": "standard",
    "variant": "Sport Interceptor"
  },
  "geometry": {
    "length_m": 11.5,
    "width_m": 11.0,
    "height_m": 3.5,
    "hull_radius_m": 7.96
  },
  "hull": {
    "dryMass_t": 10,
    "hull_HP": 1000,
    "signature_km": 9.5
  },
  "physics": {
    "linearAcceleration_mps2": { "forward": 90, "reverse": 67.5 },
    "strafeAcceleration_mps2": { "lateral": 85 },
    "angularAcceleration_dps2": { "pitch": 240, "yaw": 200, "roll": 325 }
  },
  "flightAssistLimits": {
    "crewGLimit": { "linear_g": 11.0 },
    "linearSpeedMax_mps": {
      "forward": 260,
      "reverse": 180,
      "lateral": 220,
      "vertical": 220
    },
    "angularSpeedMax_dps": { "pitch": 95, "yaw": 80, "roll": 130 }
  },
  "media": {
    "sprite": {
      "name": "Origin M50.png",
      "path": "Origin M50.png",
      "width": 1000,
      "height": 907,
      "dataUrl": "<data:image/png;base64,...>" // в реальном конфиге сюда можно вставить полный base64, либо опустить поле
    }
  }
}

12. Миграция 0.6.4 → 0.8.6 (для ИИ-редактора)

- Убрать раздел control из корабельных конфигов: способ управления задаётся глобально, а не per-ship.
- Удалить techLevel из ТТХ корабля — технологический уровень будет описываться позже в отдельной системе.
- Размер "small" заменить на "light" во всех конфигурациях. Значения snub/medium/heavy/capital оставить без изменений.
- Поля performance старого формата маппятся так:
  - performance.scm_mps          → flightAssistLimits.linearSpeedMax_mps.forward
  - performance.accel_fwd_mps2   → physics.linearAcceleration_mps2.forward
  - performance.strafe_mps2.x    → physics.strafeAcceleration_mps2.lateral
  - performance.omega_cap_dps.*  → flightAssistLimits.angularSpeedMax_dps.*
- Для flightAssistLimits.linearSpeedMax_mps.reverse/lateral/vertical:
  - если в старом конфиге есть отдельные поля (scm_reverse_mps, scm_strafe_mps и т.п.), использовать их;
  - иначе брать доли от forward в зависимости от номинала класса (по умолчанию: reverse ≈ 0.7, lateral ≈ 0.85, vertical ≈ lateral).
- performance.vmax_mps в ядре 0.8.6 не используется (скорости FA:OFF не лимитируются); при необходимости может сохраняться в отдельном блоке legacy.* для справки.
- angularAcceleration_dps2 в 0.6.4 отсутствует: брать из NOMINALS по классу корабля и затем тюнить вручную под ощущения.
- hull:dryMass_t и hull:hull_HP берутся из старого mass/dryMass_t + из баланса, а hull.signature_km вычисляется во внешней тулзе по массе/габаритам и записывается в конфиг; сервер формулу не знает и использует только готовое значение.
