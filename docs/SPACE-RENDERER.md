# SpaceRenderer - Comic-Style Sci-Fi Ð’Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ

## ÐžÐ±Ð·Ð¾Ñ€

`SpaceRenderer` â€” ÑÑ‚Ð¾ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ñ€ÐµÐ½Ð´ÐµÑ€Ð¸Ð½Ð³Ð° Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° U2, Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÑŽÑ‰Ð¸Ð¹ Ð²Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚Ð¸Ð»ÑŒ **"Ñ€Ð¸ÑÐ¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ€Ð¾Ð¼Ð°Ð½ Ð² Ð¶Ð°Ð½Ñ€Ðµ Ñ„Ð°Ð½Ñ‚Ð°ÑÑ‚Ð¸ÐºÐ°/ÐºÐ¾ÑÐ¼Ð¾Ñ"**. Ð ÐµÐ½Ð´ÐµÑ€ÐµÑ€ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ð°Ð±Ð»Ð¸, ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ„Ð¾Ð½ Ð¸ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹ Ð½Ð° Canvas 2D Ñ ÑÑÑ‚ÐµÑ‚Ð¸ÐºÐ¾Ð¹, Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°ÑŽÑ‰ÐµÐ¹ ÐºÐ¾Ð¼Ð¸ÐºÑÑ‹.

## Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

### ðŸŒŒ ÐšÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ„Ð¾Ð½
- **Ð“Ð»ÑƒÐ±Ð¾ÐºÐ¸Ð¹ ÐºÐ¾ÑÐ¼Ð¾Ñ Ñ Ð³Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚Ð¾Ð¼**: Ñ€Ð°Ð´Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð³Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚ Ð¾Ñ‚ Ñ‚Ñ‘Ð¼Ð½Ð¾-ÑÐ¸Ð½ÐµÐ³Ð¾ Ðº Ñ‡Ñ‘Ñ€Ð½Ð¾Ð¼Ñƒ
- **Ð—Ð²Ñ‘Ð·Ð´Ð½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ**: 150 Ð·Ð²Ñ‘Ð·Ð´ Ñ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ð¾Ð¹ ÑÑ€ÐºÐ¾ÑÑ‚ÑŒÑŽ Ð¸ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð¾Ð¼
- **Ð­Ñ„Ñ„ÐµÐºÑ‚ ÑÐ²ÐµÑ‡ÐµÐ½Ð¸Ñ**: ÐºÑ€ÑƒÐ¿Ð½Ñ‹Ðµ Ð·Ð²Ñ‘Ð·Ð´Ñ‹ Ð¸Ð¼ÐµÑŽÑ‚ ÑÐ²ÐµÑ‚ÑÑ‰Ð¸Ð¹ÑÑ Ð¾Ñ€ÐµÐ¾Ð»

### ðŸš€ Ð ÐµÐ½Ð´ÐµÑ€Ð¸Ð½Ð³ ÐºÐ¾Ñ€Ð°Ð±Ð»ÐµÐ¹
- **Ð¢Ñ€ÐµÑƒÐ³Ð¾Ð»ÑŒÐ½Ð°Ñ Ñ„Ð¾Ñ€Ð¼Ð°**: ÐºÐ¾Ñ€Ð°Ð±Ð»Ð¸ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²Ð°Ð½Ñ‹ Ð² Ð²Ð¸Ð´Ðµ ÑÑ‚Ð¸Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ñ‚Ñ€ÐµÑƒÐ³Ð¾Ð»ÑŒÐ½Ð¸ÐºÐ¾Ð²
- **Comic-style Ð¾Ð±Ð²Ð¾Ð´ÐºÐ°**: Ñ‚Ð¾Ð»ÑÑ‚Ñ‹Ðµ Ð»Ð¸Ð½Ð¸Ð¸ (2-3px) Ñ rounded corners
- **Ð¦Ð²ÐµÑ‚Ð¾Ð²Ð°Ñ Ð¿Ð°Ð»Ð¸Ñ‚Ñ€Ð°**:
  - Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ñ€Ð°Ð±Ð»ÑŒ: **cyan (#1ff2ff)** â€” ÑÑ€ÐºÐ¸Ð¹ Ð³Ð¾Ð»ÑƒÐ±Ð¾Ð¹
  - Ð£Ð´Ð°Ð»Ñ‘Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ñ€Ð°Ð±Ð»Ð¸: **orange (#ff6b35)** â€” Ð¾Ñ€Ð°Ð½Ð¶ÐµÐ²Ñ‹Ð¹
- **Ð“Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚Ð½Ð°Ñ Ð·Ð°Ð»Ð¸Ð²ÐºÐ°**: Ð¾Ñ‚ Ñ‚Ñ‘Ð¼Ð½Ð¾Ð³Ð¾ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ° Ðº ÑÑ€ÐºÐ¾Ð¼Ñƒ ÑÐ²ÐµÑ‡ÐµÐ½Ð¸ÑŽ
- **ÐšÐ¾ÐºÐ¿Ð¸Ñ‚**: ÑÐ²ÐµÑ‚ÑÑ‰Ð°ÑÑÑ Ñ‚Ð¾Ñ‡ÐºÐ° Ð² Ð¿ÐµÑ€ÐµÐ´Ð½ÐµÐ¹ Ñ‡Ð°ÑÑ‚Ð¸ ÐºÐ¾Ñ€Ð°Ð±Ð»Ñ

### âœ¨ Ð’Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹
- **Engine trail**: ÑÐ»ÐµÐ´ Ð¾Ñ‚ Ð´Ð²Ð¸Ð³Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¿Ñ€Ð¸ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ð¸ (Ð³Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚Ð½Ñ‹Ð¹)
- **Glow effects**: ÑÐ²ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð²Ð¾ÐºÑ€ÑƒÐ³ ÐºÐ¾Ñ€Ð°Ð±Ð»ÐµÐ¹
- **Health bar**: Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÑ Ð½Ð°Ð´ ÐºÐ¾Ñ€Ð°Ð±Ð»Ñ‘Ð¼ (Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ð¹/Ð¶Ñ‘Ð»Ñ‚Ñ‹Ð¹/ÐºÑ€Ð°ÑÐ½Ñ‹Ð¹)
- **Online indicator**: Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ

### ðŸ“Š HUD ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹
- **Comic-style text**: Ñ‚ÐµÐºÑÑ‚ Ñ Ñ‚Ð¾Ð»ÑÑ‚Ð¾Ð¹ Ð±ÐµÐ»Ð¾Ð¹ Ð¾Ð±Ð²Ð¾Ð´ÐºÐ¾Ð¹
- **Status messages**: ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð² Ñ†ÐµÐ½Ñ‚Ñ€Ðµ ÑÐºÑ€Ð°Ð½Ð°
- **Debug info**: Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ tick, ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° ÑÑƒÑ‰Ð½Ð¾ÑÑ‚ÐµÐ¹, Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)

## Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ

```typescript
import { SpaceRenderer } from './rendering/SpaceRenderer';

// Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ
const canvas = document.querySelector('canvas');
const ctx = canvas.getContext('2d');

const renderer = new SpaceRenderer(ctx, {
  width: canvas.width,
  height: canvas.height,
  showDebugInfo: false // Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ/Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ
});

// Ð ÐµÐ½Ð´ÐµÑ€Ð¸Ð½Ð³ Ñ„Ñ€ÐµÐ¹Ð¼Ð°
renderer.render(worldSnapshot, localEntityId);

// Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹
renderer.drawOnlineIndicator(isOnline, isConnected);
renderer.drawHudMessage('Press O to connect');

// Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð°
window.addEventListener('resize', () => {
  renderer.resize(newWidth, newHeight);
});
```

## Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ NetworkManager

Ð ÐµÐ½Ð´ÐµÑ€ÐµÑ€ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ñ `NetworkManager` Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ ÑÐ½Ð¸Ð¼ÐºÐ¾Ð² ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ñ ÑÐµÑ€Ð²ÐµÑ€Ð°:

```typescript
networkManager.onStateUpdate((state) => {
  latestSnapshot = state.snapshot;
  localEntityId = state.localEntityId;
});

// Ð’ Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð¼ Ñ†Ð¸ÐºÐ»Ðµ
renderer.render(latestSnapshot, localEntityId);
```

## Ð’Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚Ð¸Ð»ÑŒ

### Ð¦Ð²ÐµÑ‚Ð¾Ð²Ð°Ñ Ð¿Ð°Ð»Ð¸Ñ‚Ñ€Ð°
- **ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ„Ð¾Ð½**: `#010204` â†’ `#0d1821` (deep space gradient)
- **Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ñ€Ð°Ð±Ð»ÑŒ**: `#1ff2ff` (cyan), glow: `#00d9ff`
- **Ð£Ð´Ð°Ð»Ñ‘Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ñ€Ð°Ð±Ð»Ð¸**: `#ff6b35` (orange), glow: `#ff8c42`
- **HUD ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹**: `#ffffff` (white) Ñ cyan Ð°ÐºÑ†ÐµÐ½Ñ‚Ð°Ð¼Ð¸
- **Health bar**: 
  - > 60%: `#4ade80` (green)
  - 30-60%: `#fbbf24` (yellow)
  - < 30%: `#ef4444` (red)

### Ð Ð°Ð·Ð¼ÐµÑ€Ñ‹ Ð¸ Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¸
- **Ð Ð°Ð·Ð¼ÐµÑ€ ÐºÐ¾Ñ€Ð°Ð±Ð»Ñ**: 30px (Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€)
- **Ð¢Ð¾Ð»Ñ‰Ð¸Ð½Ð° Ð¾Ð±Ð²Ð¾Ð´ÐºÐ¸**: 2-3px (Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ñ€Ð°Ð±Ð»ÑŒ Ñ‚Ð¾Ð»Ñ‰Ðµ)
- **Ð—Ð²Ñ‘Ð·Ð´Ñ‹**: 0.5-2.5px
- **Engine trail**: Ð´Ð¾ 60px Ð² Ð´Ð»Ð¸Ð½Ñƒ (Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸)

## ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ

- **ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ° Ð·Ð²Ñ‘Ð·Ð´**: Ð¿Ñ€ÐµÐ´Ð²Ð°Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
- **Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚Ð¾Ð²**: ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð¼, Ð³Ð´Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾
- **ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ðµ state changes**: Ð³Ñ€ÑƒÐ¿Ð¿Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹

## Ð‘ÑƒÐ´ÑƒÑ‰Ð¸Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ

- [ ] Parallax ÑÑ„Ñ„ÐµÐºÑ‚ Ð´Ð»Ñ Ð·Ð²Ñ‘Ð·Ð´ (Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ñ„Ð¾Ð½Ð° Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ð¸ ÐºÐ°Ð¼ÐµÑ€Ñ‹)
- [ ] Particle system Ð´Ð»Ñ Ð²Ð·Ñ€Ñ‹Ð²Ð¾Ð² Ð¸ Ð¿Ð¾Ð²Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ð¹
- [ ] ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ engine trail (Ð¼ÐµÑ€Ñ†Ð°Ð½Ð¸Ðµ)
- [ ] WebGL renderer Ð´Ð»Ñ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ñ… ÑÑ„Ñ„ÐµÐºÑ‚Ð¾Ð²
- [ ] Post-processing effects (bloom, chromatic aberration)
- [ ] Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ‚Ð¸Ð¿Ñ‹ ÐºÐ¾Ñ€Ð°Ð±Ð»ÐµÐ¹ Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð³ÐµÐ¾Ð¼ÐµÑ‚Ñ€Ð¸ÐµÐ¹

## ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹

### Offline Mode
![Offline Mode](https://github.com/user-attachments/assets/a63d6272-aaea-47d2-a8cb-23fd99ecdd6e)

*ÐšÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ„Ð¾Ð½ ÑÐ¾ Ð·Ð²Ñ‘Ð·Ð´Ð°Ð¼Ð¸ Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ "OFFLINE MODE - Press 'O' to connect"*

### Online Mode (Coming Soon)
ÐšÐ¾Ð³Ð´Ð° ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ñ‘Ð½ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ, ÐºÐ¾Ñ€Ð°Ð±Ð»Ð¸ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð¸Ð· `WorldSnapshotProto` Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸ÐµÐ¹ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ Ð¸ ÑÑ„Ñ„ÐµÐºÑ‚Ð°Ð¼Ð¸.

## Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸

- **Ð¤Ð°Ð¹Ð»**: `src/rendering/SpaceRenderer.ts` (340 ÑÑ‚Ñ€Ð¾Ðº)
- **Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸**: Canvas 2D API, protobuf types
- **Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ**: `tests/rendering.spec.ts` (jsdom environment)
- **Ð¡Ð±Ð¾Ñ€ÐºÐ°**: Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾ Ð² Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ bundle (~90kB)

## Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ

- [M2.3-PLAN.md](../M2.3-PLAN.md) - ÐŸÐ»Ð°Ð½ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
- [NetworkManager](../src/network/NetworkManager.ts) - Ð¡ÐµÑ‚ÐµÐ²Ð¾Ð¹ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€
- [Protobuf Schema](../src/shared/Proto/ecs.proto) - Ð¡Ñ…ÐµÐ¼Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
