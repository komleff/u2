# U2 Server Automation Scripts

Этот каталог содержит скрипты для автоматического запуска серверов проекта U2 для онлайн-тестирования.

## Назначение

Скрипты автоматизируют запуск следующих компонентов:

1. **C# Backend Server** - серверная часть игры
   - UDP сервер на порту 7777
   - WebSocket relay на порту 8080
   
2. **Vite Development Client** - клиентская часть
   - HTTP сервер на порту 5173

## Использование

### Linux / macOS

```bash
./scripts/start-servers.sh
```

Скрипт автоматически:
- Проверит наличие необходимых зависимостей (.NET SDK, Node.js)
- Проверит доступность портов
- Соберет C# проект
- Запустит оба сервера
- Выведет информацию о подключении
- Будет ожидать нажатия Ctrl+C для остановки

### Windows

```batch
scripts\start-servers.bat
```

Скрипт откроет два отдельных окна:
- Одно для C# backend сервера
- Одно для Vite client сервера

Для остановки серверов закройте соответствующие окна или нажмите Ctrl+C в них.

## Требования

- **.NET 8.0 SDK** или выше
- **Node.js 18** или выше
- **npm** (устанавливается вместе с Node.js)

## Порты

По умолчанию используются следующие порты:

| Сервис | Протокол | Порт | URL |
|--------|----------|------|-----|
| Backend UDP | UDP | 7777 | localhost:7777 |
| Backend WebSocket | WebSocket | 8080 | ws://localhost:8080/ |
| Client | HTTP | 5173 | http://localhost:5173/ |

## Логи

### Linux / macOS

Логи сохраняются в:
- Backend: `/tmp/u2-backend.log`
- Client: `/tmp/u2-client.log`

### Windows

Логи отображаются непосредственно в окнах серверов.

## Устранение неполадок

### Порт уже занят

Если порт занят другим процессом, скрипт выдаст ошибку. Найдите и остановите процесс, занимающий порт:

**Linux / macOS:**
```bash
# Найти процесс
lsof -i :7777
lsof -i :8080
lsof -i :5173

# Остановить процесс
kill -9 <PID>
```

**Windows:**
```batch
# Найти процесс
netstat -ano | findstr :7777
netstat -ano | findstr :8080
netstat -ano | findstr :5173

# Остановить процесс
taskkill /PID <PID> /F
```

### Backend сервер не запускается

1. Проверьте, что .NET 8.0 SDK установлен:
   ```bash
   dotnet --version
   ```

2. Попробуйте собрать проект вручную:
   ```bash
   dotnet build U2.sln
   ```

3. Проверьте логи в `/tmp/u2-backend.log` (Linux/macOS)

### Client сервер не запускается

1. Проверьте, что зависимости установлены:
   ```bash
   npm install
   ```

2. Попробуйте запустить вручную:
   ```bash
   npm run dev
   ```

3. Проверьте логи в `/tmp/u2-client.log` (Linux/macOS)

## Ручной запуск

Если автоматический скрипт не работает, можно запустить серверы вручную:

### Backend (в отдельном терминале)
```bash
dotnet run --project src/server/U2.Server.csproj -- --network
```

### Client (в отдельном терминале)
```bash
npm run dev
```

## Разработка

При разработке новых функций рекомендуется запускать серверы в отдельных терминалах для лучшей видимости логов и возможности перезапуска только одного из компонентов.

## Дополнительная информация

Подробнее о проекте см. в [README.md](../README.md) в корне репозитория.
